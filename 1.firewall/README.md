# üî• Servidor Firewall (nftables)

<br/>

Este documento apresenta as etapas para **configura√ß√£o do firewall** em servidores **Debian 13 (Trixie)** utilizando o **nftables**, respons√°vel pelo controle e filtragem do tr√°fego entre as redes LAN, DMZ e WAN.

---

<br/>

## üéØ Objetivo

O **Firewall** tem como fun√ß√£o **controlar o tr√°fego de entrada e sa√≠da de pacotes** entre redes, protegendo os servidores e usu√°rios de acessos indevidos.  
Com o **nftables**, √© poss√≠vel definir pol√≠ticas de seguran√ßa, NAT (Network Address Translation) e regras de encaminhamento de pacotes de forma moderna e eficiente.

---

<br/>

## üß© Descri√ß√£o do Servi√ßo

| Item | Detalhe |
|------|----------|
| **Software** | nftables |
| **Sistema operacional** | Debian 13 (Trixie) |
| **Fun√ß√£o** | Controle de tr√°fego e NAT entre redes (LAN ‚Üî DMZ ‚Üî WAN) |
| **Arquivos principais** | `/etc/nftables.conf` e `/etc/sysctl.d/99-custom-forwarding.conf` |
| **Servi√ßo** | `nftables.service` |

---

<br/>

## ‚öôÔ∏è Instala√ß√£o e Configura√ß√£o do Firewall

<br/>

### 1Ô∏è‚É£ Habilitar o encaminhamento de pacotes (IP Forwarding)

Crie o arquivo `/etc/sysctl.d/99-custom-forwarding.conf`:

```bash
sudo vim /etc/sysctl.d/99-custom-forwarding.conf
```

<br/>

Adicione o conte√∫do abaixo:

```bash
net.ipv4.ip_forward=1
```

<br/>

Aplique a configura√ß√£o:

```bash
sudo sysctl --system
```

> Essa etapa garante que o servidor possa encaminhar pacotes entre interfaces de rede distintas (fun√ß√£o essencial de um firewall).

---

<br/>

### 2Ô∏è‚É£ Configurar o nftables

Substitua o conte√∫do do arquivo principal do firewall:

```bash
sudo vim /etc/nftables.conf
```

Copie o conte√∫do do arquivo [`nftables.conf`](./configs/nftables.conf) deste reposit√≥rio e personalize conforme o ambiente (interfaces, sub-redes e regras de filtragem).

---

<br/>

### 3Ô∏è‚É£ Aplicar e testar a configura√ß√£o

Teste o arquivo de regras antes de ativar o servi√ßo:

```bash
sudo nft -f /etc/nftables.conf
```

<br/>

Visualize as regras aplicadas:

```bash
sudo nft list ruleset
```

---

<br/>

### 4Ô∏è‚É£ Habilitar o servi√ßo nftables

```bash
sudo systemctl enable nftables
sudo systemctl start nftables
sudo systemctl status nftables
```

> Ap√≥s reiniciar o servidor, o firewall ser√° carregado automaticamente.

---

<br/>

## üß™ Testes de funcionamento

Ap√≥s aplicar as regras, execute testes de conectividade entre as zonas:

```bash
# Teste de ping entre clientes e DMZ
ping 10.0.2.2

# Verificar NAT de sa√≠da para a WAN
curl ifconfig.me
```

<br/>

Para logs e diagn√≥sticos:

```bash
sudo journalctl -u nftables
```

---
