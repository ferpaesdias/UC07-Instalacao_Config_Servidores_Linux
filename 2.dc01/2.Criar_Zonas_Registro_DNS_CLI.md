# Criar Zonas e Registros DNS usando linhas de comando (CLI) 

Execute estes comandos no servidor DC01.

## Verifique os servidores DC

Digite o comando abaixo:

```bash
host -t srv _ldap._tcp.dc._msdcs.empresatech.example
```
- **host**: É um programa usado para consultar DNS.
- **-t srv**: Especifica o tipo de consulta para registro *SRV*.
- **_ldap._tcp**: Indica serviço LDAP (`_ldap`) que funciona via TCP (`_tcp`). O LDAP é o protocolo usado pelo AD.
- **dc._msdcs**: MSDCS (Microsoft Domain Controller Services) é uma zona obrigatória no AD, que contém registros relacionados a: 
  - Localização de DCs
  - Globally Unique Identifiers (GUIDs)
  - Replicação entre controladores
  - Serviços essenciais do AD

<br/>

Output:
Se já promoveu o servidor DC02 a Domain Controller, na saída do comando irá aparecer duas linhas, igual está abaixo:
```bash
_ldap._tcp.dc._msdcs.empresatech.example has SRV record 0 100 389 dc01.empresatech.example.
_ldap._tcp.dc._msdcs.empresatech.example has SRV record 0 100 389 dc02.empresatech.example.
```
- **389** = Porta do LDAP
- **dc01.empresatech.example** = o DC (se houver outro DC, ele aparece na lista)
- **0** = Prioridade (menor = mais importante)
- **100** = Peso (balanceamento de carga)



<br/>

---

## Adicionar registro DNS

Adicionando um registro para o servidor **DHCP01** de IP **192.168.100.203**:

```bash
sudo samba-tool dns add dc01 empresatech.example dhcp01 A 192.168.100.203 -U Administrator
```
- **samba-tool dns add**: Adiciona um registro DNS.
- **dc01**: Indica o servidor DC onde será adicionar o registro.
- **empresatech.example**: É a zona DNS em que o registro será criado.
- **dhcp01**: O nome do host.
- **A**: O tipo de registro DNS.
- **192.168.100.203**: Endereço IP do host *dhcp01*.
- **-U Administrator**: Usuário que está executando a ação.


<br/>

Teste a configuração:

```bash
host -t A dhcp01
```

<br/>

Output:

```bash
dhcp01.empresatech.example has address 192.168.100.203
```

<br/>


Adicionando um registro para o servidor **FS01** (File Server) de IP **192.168.100.202**:

```bash
sudo samba-tool dns add dc01 empresatech.example fs01 A 192.168.100.202 -U Administrator
```

<br/>

Teste a configuração:

```bash
host -t A fs01
```

<br/>

Output:

```bash
fs01.empresatech.example has address 192.168.100.202
```

<br/>

--- 

## Zona Reversa


### Criar Zona Reversa

A zona reversa é o que permite ao DNS converter IP em nome. Para criar uma Zona Reversa use o comando abaixo:

```bash
sudo samba-tool dns zonecreate dc01 100.168.192.in-addr.arpa -U Administrator
```
- **samba-tool dns zonecreate**: Cria uma nova zona DNS dentro do DNS do Active Directory.
- **dc01**: É o servidor DNS no qual a zona será criada.
- **100.168.192.in-addr.arpa**: Essa é a zona reversa para a rede.
- **-U Administrator**: Usuário que está executando a ação.

<br/>

### Adicionar registro na Zona Reversa

Adicionando um registro em uma *Zona Reversa* para o servidor **DC01** de IP **192.168.100.200**:

```bash
sudo samba-tool dns add dc01 100.168.192.in-addr.arpa 200 PTR dc01.empresatech.example -U Administrator
```
- **samba-tool dns add**: Adiciona um registro DNS.
- **dc01**: É o servidor DNS no qual o registro será adicionado.
- **100.168.192.in-addr.arpa**: É a zona reversa da rede.
- **200**: É o último octeto do IP para o qual você está criando o reverso.
- **PTR**: O tipo de registro DNS.
- **dc01.empresatech.example**: É o nome completo (FQDN) do servidor que esse IP aponta.
- **-U Administrator**: Usuário que está executando a ação.

<br/>

Teste a configuração:

```bash
host -t PTR 192.168.100.200
```

<br/>

Output:

```bash
200.100.168.192.in-addr.arpa domain name pointer dc01.empresatech.example.
```

<br/>


Também adicione um registro em uma *Zona Reversa* para os servidores **FS01** de IP **192.168.100.202** e **DHCP01** de IP **192.168.100.203**:

```bash
sudo samba-tool dns add dc01 100.168.192.in-addr.arpa 202 PTR fs01.empresatech.example -U Administrator
sudo samba-tool dns add dc01 100.168.192.in-addr.arpa 203 PTR dhcp01.empresatech.example -U Administrator
```

<br/>

## Listar Zonas DNS


Para criar uma Zona Reversa use o comando abaixo:

```bash
sudo samba-tool dns zonelist dc01 -U Administrator
```

<br/>

Output:

```bash
  3 zone(s) found

  pszZoneName                 : empresatech.example
  Flags                       : DNS_RPC_ZONE_DSINTEGRATED DNS_RPC_ZONE_UPDATE_SECURE 
  ZoneType                    : DNS_ZONE_TYPE_PRIMARY
  Version                     : 50
  dwDpFlags                   : DNS_DP_AUTOCREATED DNS_DP_DOMAIN_DEFAULT DNS_DP_ENLISTED 
  pszDpFqdn                   : DomainDnsZones.empresatech.example

  pszZoneName                 : 100.168.192.in-addr.arpa
  Flags                       : DNS_RPC_ZONE_DSINTEGRATED DNS_RPC_ZONE_UPDATE_SECURE 
  ZoneType                    : DNS_ZONE_TYPE_PRIMARY
  Version                     : 50
  dwDpFlags                   : DNS_DP_AUTOCREATED DNS_DP_DOMAIN_DEFAULT DNS_DP_ENLISTED 
  pszDpFqdn                   : DomainDnsZones.empresatech.example

  pszZoneName                 : _msdcs.empresatech.example
  Flags                       : DNS_RPC_ZONE_DSINTEGRATED DNS_RPC_ZONE_UPDATE_SECURE 
  ZoneType                    : DNS_ZONE_TYPE_PRIMARY
  Version                     : 50
  dwDpFlags                   : DNS_DP_AUTOCREATED DNS_DP_FOREST_DEFAULT DNS_DP_ENLISTED 
  pszDpFqdn                   : ForestDnsZones.empresatech.example

```